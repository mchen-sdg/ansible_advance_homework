---

# tasks file for osp.servers
- name: Create new server instances and attaches them a network and passes metadata to the instance
  os_server:
    state: present
    cloud: "{{ cloud }}"
    name: "{{ item.value.name }}"
    image: "{{ item.value.image }}"
    key_name: "{{ item.value.key_name }}"
    flavor: "{{ item.value.flavor }}"
    meta: "{{ item.value.meta }}"
    security_groups: "{{ item.value.security_group }}"
    nics:
     - net-name: "{{ int_network }}"
    userdata: |
      #cloud-config
      ssh_authorized_keys:
          - "{{ openstack_pubkey }}"
          - "{{ opentlc_pubkey }}"
  loop: "{{ osp_servers|dict2items }}"
  loop_control:
    label: "{{ item.value.name }}"

#- name: Add floating IP to Servers
   

#- name: Wait for server to be available
